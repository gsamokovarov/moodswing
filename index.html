<!DOCTYPE html>

<html>
<head>
  <title>moodswing.coffee</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <link rel="stylesheet" media="all" href="public/stylesheets/normalize.css" />
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div class="container">
    <div class="page">

      <div class="header">
        
          <h1>moodswing.coffee</h1>
        

        
      </div>

      
        
        <p><strong>Moodswing</strong> uses <a href="http://jashkenas.github.com/coffee-script/">CoffeeScript</a>
to provide assertions which can look like English sentences.</p>
<pre><code class="lang-coffeescript">    expect(true).to be: true
    expect([]).to have: length: of: 0
    dontExpect(-&gt; null).to raise: Error
    dontExpect(&#39;this&#39;).to be: equal: to: &#39;that&#39;</code></pre>
<p>This is possible because of the
<a href="http://jashkenas.github.com/coffee-script/">CoffeeScript</a> object
<a href="http://jashkenas.github.com/coffee-script/#literals">literal</a> syntax. For
example the line <code>expect([]).to have: length: of: 0</code> is equal to the call
<code>new Expectation([]).haveLengthOf(0)</code>.</p>
<p>This means that the object <code>have: length: of: 0</code>, which we call a
 <em>directive</em>, is translated to a method named <code>haveLengthOf</code> using
camel case notation. This method is then looked for in the
<code>Expectation.prototype</code> and is being called with the <em>reminder</em> of the
object.</p>
<p>The <code>Expectation</code> constructor is publicly available, so you can augment its
prototype with your own directives.</p>
<p>You can install moodswing through <a href="http://npmjs.org">NPM</a></p>
<pre><code>npm install moodswing</code></pre>
<p>To use moodswing just require it in your tests</p>
<pre><code>{expect, dontExpect, Expectation} = require &#39;moodswing&#39;</code></pre>
<p>The code is available on <a href="http://github.com/gsamokovarov/moodswing">github</a>
under MIT license.</p>
<h2>Prerequisites</h2>

        
      
        
        <p>Require <code>inspect</code> for prettier object printings.</p>

        
          <div class='highlight'><pre>{inspect} = require <span class="string">'util'</span></pre></div>
        
      
        
        <p>Require the standard <a href="https://nodejs.org">node</a> assertion module for most of our <em>low level</em>
assertions. This gives us the nice benefit to be able to run our tests on
<a href="http://visionmedia.github.com/expresso/">expresso</a>.</p>

        
          <div class='highlight'><pre>assert = require <span class="string">'assert'</span></pre></div>
        
      
        
        <h2>Public API</h2>

        
      
        
        <p>The expectation object is responsible for the assertions behavior. All of the
assertions pointed by the directives are living in its prototype.</p>

        
          <div class='highlight'><pre><span class="class"><span class="keyword">class</span> <span class="title">exports</span>.<span class="title">Expectation</span></span>
  constructor: (target, options = {}) -&gt;
    <span class="property">@negate</span> = options.negate <span class="keyword">or</span> <span class="literal">false</span>
    Object.defineProperty <span class="keyword">this</span>, <span class="string">'target'</span>,
      get: -&gt;
        <span class="keyword">return</span> target <span class="keyword">unless</span> <span class="keyword">typeof</span> target <span class="keyword">is</span> <span class="string">"function"</span>
        target()</pre></div>
        
      
        
        <p>Assert <code>@target</code> to be equal to <code>other</code> object.</p>

        
          <div class='highlight'><pre>  beEqual: (other) -&gt;
    <span class="keyword">if</span> <span class="property">@negate</span>
      assert.notEqual <span class="property">@target</span>, other
    <span class="keyword">else</span>
      assert.equal <span class="property">@target</span>, other
    <span class="keyword">this</span></pre></div>
        
      
        
        <p>Assert <code>@target</code> to be strictly equal to <code>other</code> object.</p>

        
          <div class='highlight'><pre>  beStrictly: (other) -&gt;
    <span class="keyword">if</span> <span class="property">@negate</span>
      assert.notStrictEqual <span class="property">@target</span>, other
    <span class="keyword">else</span>
      assert.strictEqual <span class="property">@target</span>, other
    <span class="keyword">this</span></pre></div>
        
      
        
        <p>Assert <code>@target</code> to be deeply equal to <code>other</code> object.</p>

        
          <div class='highlight'><pre>  beDeeply: (other) -&gt;
    <span class="keyword">if</span> <span class="property">@negate</span>
      assert.notDeepEqual <span class="property">@target</span>, other
    <span class="keyword">else</span>
      assert.deepEqual <span class="property">@target</span>, other
    <span class="keyword">this</span></pre></div>
        
      
        
        <p>Assert <code>@target</code> to be an instance of <code>kind</code>.</p>

        
          <div class='highlight'><pre>  beAnInstanceOf: (kind) -&gt;
    <span class="keyword">if</span> <span class="property">@negate</span>
      assert.ok !(<span class="property">@target</span> <span class="keyword">instanceof</span> kind), <span class="string">"Did not expected <span class="subst">#{@target}</span> to be and instance of <span class="subst">#{kind}</span>"</span>
    <span class="keyword">else</span>
      assert.ok <span class="property">@target</span> <span class="keyword">instanceof</span> kind, <span class="string">"Expected <span class="subst">#{@target}</span> to be an instance of <span class="subst">#{kind}</span>"</span>
    <span class="keyword">this</span></pre></div>
        
      
        
        <p>Assert <code>@target</code> have a property <code>name</code>.</p>

        
          <div class='highlight'><pre>  haveProperty: (name) -&gt;
    <span class="keyword">if</span> <span class="property">@negate</span>
      assert.ok <span class="keyword">not</span> <span class="property">@target</span>[name]?, <span class="string">"Did not expected a property <span class="subst">#{name}</span> in <span class="subst">#{inspect @target}</span>"</span>
    <span class="keyword">else</span>
      assert.ok <span class="property">@target</span>[name]?, <span class="string">"Expected property <span class="subst">#{name}</span> in <span class="subst">#{inspect @target}</span>"</span>
    <span class="keyword">this</span></pre></div>
        
      
        
        <p>Assert <code>@target</code> have property <code>length</code> of <code>len</code>.</p>

        
          <div class='highlight'><pre>  haveLength: (len) -&gt;
    <span class="property">@haveProperty</span> <span class="string">'length'</span>
    <span class="keyword">if</span> <span class="property">@negate</span>
      assert.notEqual <span class="property">@target</span>.length, len
    <span class="keyword">else</span>
      assert.equal <span class="property">@target</span>.length, len
    <span class="keyword">this</span></pre></div>
        
      
        
        <p>Assert <code>@target</code> to raise an <code>error</code> of the kind.</p>

        
          <div class='highlight'><pre>  raise: (error) -&gt;
    <span class="keyword">try</span>
      <span class="property">@target</span>
    <span class="keyword">catch</span> e
      <span class="keyword">if</span> <span class="property">@negate</span>
        <span class="keyword">throw</span> <span class="keyword">new</span> assert.AssertionError <span class="string">"Did not expected an error of <span class="subst">#{error}</span> kind."</span>
      <span class="keyword">else</span>
        assert.ok e <span class="keyword">instanceof</span> error, <span class="string">"Expected error of <span class="subst">#{error}</span> kind; got: <span class="subst">#{e}</span>"</span>
    <span class="keyword">this</span></pre></div>
        
      
        
        <p>Used to define <code>Expectation.prototype</code> aliases. This is really useful because
you can define the verbosity of the expectation, depending of the context.</p>

        
          <div class='highlight'><pre>exports.Expectation.<span class="function"><span class="title">alias</span></span> = (dict) -&gt;
  <span class="keyword">for</span> name, aliases <span class="keyword">of</span> dict
    exports.Expectation::[as] = exports.Expectation::[name] <span class="keyword">for</span> as <span class="keyword">in</span> aliases</pre></div>
        
      
        
        <p>Parses a <code>directive</code> into a method call. Returns self if none given.</p>
<p>A <code>directive</code> is an deep object of the kind <code>be: equal: to: true</code> which
points to a camel cased method and a parameter to call it with. Since there
can be more then one method matching a given <code>directive</code>, we will always call
the longest one we match.</p>

        
          <div class='highlight'><pre>exports.Expectation::<span class="function"><span class="title">to</span></span> = (directive) -&gt;</pre></div>
        
      
        
        <p>Supports <code>expect(object).to().beEqual(another)</code>.</p>

        
          <div class='highlight'><pre>  <span class="keyword">return</span> <span class="keyword">this</span> <span class="keyword">unless</span> directive?</pre></div>
        
      
        
        <p>Help preventing the function to call itself.</p>

        
          <div class='highlight'><pre>  <span class="keyword">throw</span> <span class="keyword">new</span> TypeError <span class="string">"Can not start a directive with 'to'"</span> <span class="keyword">if</span> directive.to?

  possibilities = {}</pre></div>
        
      
        
        <p>Find all the methods pointed by the directive.</p>

        
          <div class='highlight'><pre>  method = <span class="keyword">new</span> String
  <span class="keyword">while</span> keys(directive).length <span class="keyword">isnt</span> <span class="number">0</span>
    <span class="keyword">break</span> <span class="keyword">unless</span> <span class="keyword">typeof</span> directive <span class="keyword">is</span> <span class="string">'object'</span>
    <span class="keyword">for</span> part, directive <span class="keyword">of</span> directive
      method += <span class="keyword">if</span> method.length <span class="keyword">is</span> <span class="number">0</span> <span class="keyword">then</span> part <span class="keyword">else</span> capitalize part
      possibilities[method] = directive <span class="keyword">if</span> @[method]?

  <span class="keyword">if</span> keys(possibilities).length <span class="keyword">is</span> <span class="number">0</span>
    <span class="keyword">throw</span> TypeError <span class="string">"No suitable directive found: <span class="subst">#{inspect directive}</span>"</span></pre></div>
        
      
        
        <p>Call the longest one of them.</p>

        
          <div class='highlight'><pre>  <span class="function"><span class="title">longest</span></span> = (keys(possibilities).sort (left, right) -&gt;
    left.length - right.length
  ).pop()

  @[longest](possibilities[longest])</pre></div>
        
      
        
        <p>Create an expectation for the <code>target</code>. This is actually the main function
that we&#39;ll be using. The <code>target</code></p>

        
          <div class='highlight'><pre>exports.<span class="function"><span class="title">expect</span></span> = (target) -&gt;
  <span class="keyword">new</span> exports.Expectation target</pre></div>
        
      
        
        <p>Create an negated expectation for the <code>target</code>. The second most used function
after <code>expect</code>.</p>

        
          <div class='highlight'><pre>exports.<span class="function"><span class="title">dontExpect</span></span> = (target) -&gt;
  <span class="keyword">new</span> exports.Expectation target, negate: <span class="literal">true</span></pre></div>
        
      
        
        <p>Now we define some common aliases.</p>

        
          <div class='highlight'><pre>exports.Expectation.alias
  beEqual: [<span class="string">'beEqualOf'</span>, <span class="string">'beEqualTo'</span> , <span class="string">'be'</span>]
  beStrictly: [<span class="string">'beStrictlyEqualOf'</span>, <span class="string">'beStrictlyEqualTo'</span> , <span class="string">'beStrictlyEqual'</span>]
  beDeeply: [<span class="string">'beDeeplyEqualOf'</span>, <span class="string">'beDeeplyEqualTo'</span> , <span class="string">'beDeeplyEqual'</span>]
  beAnInstanceOf: [<span class="string">'beInstanceOf'</span>, <span class="string">'beA'</span>]
  haveProperty: [<span class="string">'havePropertyOf'</span>, <span class="string">'have'</span>]
  haveLength: [<span class="string">'haveLengthOf'</span>]
  raise: [<span class="string">'throw'</span>, <span class="string">'throws'</span>]</pre></div>
        
      
        
        <h2>Helpers</h2>

        
      
        
        <p>Primitive safe <code>Object.keys</code> implementation.</p>

        
          <div class='highlight'><pre><span class="function"><span class="title">keys</span></span> = (something) -&gt;
  Object.keys(Object something)</pre></div>
        
      
        
        <p>Capitalizes a string.</p>

        
          <div class='highlight'><pre><span class="function"><span class="title">capitalize</span></span> = (str) -&gt;
  <span class="string">"<span class="subst">#{str[<span class="number">0</span>].toUpperCase()}</span><span class="subst">#{str[<span class="number">1.</span>..]}</span>"</span></pre></div>
        
      
        
        <p>Have fun.</p>

        
      
      <div class="fleur">h</div>
    </div>
  </div>
</body>
</html>
